<?xml version="1.0" encoding="UTF-8"?>
<page-structure>
  <metadata>
    <name>Chat Page</name>
    <route>/chat/:personaId?</route>
    <component>ChatView.vue</component>
    <description>Real-time chat interface with AI persona</description>
  </metadata>

  <design-principles>
    <principle source="kickofflabs.com">
      <name>Color Palette Limitation</name>
      <compliance>Yes</compliance>
      <details>Uses 1-2 colors: indigo for user messages, minimal color usage</details>
    </principle>
    <principle source="kickofflabs.com">
      <name>Single Font Family</name>
      <compliance>Yes</compliance>
      <details>Uses Inter font family throughout</details>
    </principle>
    <principle source="kickofflabs.com">
      <name>4px Grid System</name>
      <compliance>Yes</compliance>
      <details>All spacing uses 4px increments</details>
    </principle>
  </design-principles>

  <color-palette>
    <user-message>
      <color>indigo-600 (#4f46e5)</color>
      <usage>User message bubbles</usage>
    </user-message>
    <persona-message>
      <color>card background (rgba(26, 31, 58, 0.5))</color>
      <usage>Persona message bubbles</usage>
      <border>border-gray-700</border>
    </persona-message>
    <primary-cta>
      <color>indigo-500 to purple-600 gradient</color>
      <usage>Send button</usage>
    </primary-cta>
    <background>
      <color>akashic gradient</color>
      <usage>Page background</usage>
    </background>
  </color-palette>

  <typography>
    <font-family>Inter, system-ui, sans-serif</font-family>
    <variations>
      <variation>
        <name>Page Title</name>
        <weight>bold (700)</weight>
        <size>text-3xl (30px)</size>
        <effect>text-gradient</effect>
      </variation>
      <variation>
        <name>Message Text</name>
        <weight>regular (400)</weight>
        <size>text-base (16px)</size>
      </variation>
      <variation>
        <name>Timestamp</name>
        <weight>regular (400)</weight>
        <size>text-xs (12px)</size>
      </variation>
    </variations>
  </typography>

  <spacing-system>
    <base-unit>4px</base-unit>
    <usage>
      <spacing>space-y-6 (24px) between major sections</spacing>
      <spacing>space-y-4 (16px) between messages</spacing>
      <spacing>gap-4 (16px) in form layout</spacing>
      <spacing>p-4 (16px) message bubble padding</spacing>
    </usage>
  </spacing-system>

  <layout-structure>
    <container type="page">
      <max-width>max-w-4xl</max-width>
      <spacing>space-y-6</spacing>
      
      <header>
        <layout>flex items-center justify-between</layout>
        <title>Chat with {persona.name}</title>
        <size>text-3xl</size>
        <effect>text-gradient</effect>
        <subtitle>{persona.archetype} Type</subtitle>
        <color>text-secondary</color>
        <button type="ghost" text="Back to Room" />
      </header>
      
      <chat-container>
        <type>card</type>
        <height>h-96 (384px)</height>
        <overflow>overflow-y-auto</overflow>
        <spacing>space-y-4</spacing>
        
        <messages>
          <message type="user">
            <alignment>justify-end</alignment>
            <bubble>
              <background>bg-indigo-600</background>
              <text-color>text-white</text-color>
              <max-width>max-w-xs md:max-w-md</max-width>
              <padding>p-4</padding>
              <border-radius>rounded-lg</border-radius>
            </bubble>
            <content>{message.text}</content>
            <timestamp>text-xs opacity-70 mt-2</timestamp>
          </message>
          
          <message type="persona">
            <alignment>justify-start</alignment>
            <bubble>
              <background>bg-card</background>
              <text-color>text-white</text-color>
              <border>border border-gray-700</border>
              <max-width>max-w-xs md:max-w-md</max-width>
              <padding>p-4</padding>
              <border-radius>rounded-lg</border-radius>
            </bubble>
            <content>{message.text}</content>
            <timestamp>text-xs opacity-70 mt-2</timestamp>
          </message>
          
          <message type="loading" conditional="isSending">
            <alignment>justify-start</alignment>
            <bubble>
              <background>bg-card</background>
              <border>border border-gray-700</border>
              <padding>p-4</padding>
              <component>LoadingSpinner (sm)</component>
            </bubble>
          </message>
        </messages>
      </chat-container>
      
      <input-section>
        <type>card</type>
        <form>
          <layout>flex gap-4</layout>
          <input>
            <type>text</type>
            <placeholder>Type your message...</placeholder>
            <class>input flex-1</class>
            <disabled>isSending</disabled>
          </input>
          <button type="submit" text="Send" disabled="!messageInput.trim() || isSending" loading="isSending" />
        </form>
      </input-section>
    </container>
  </layout-structure>

  <components>
    <component name="Button" usage="Send message and navigation">
      <variants>primary, ghost</variants>
      <states>disabled, loading</states>
    </component>
    <component name="LoadingSpinner" usage="Message sending indicator">
      <size>sm</size>
    </component>
  </components>

  <states>
    <state type="loading">
      <display>LoadingSpinner centered</display>
      <condition>isLoading && chatHistory.length === 0</condition>
    </state>
    <state type="ready">
      <display>Chat interface with messages</display>
    </state>
    <state type="sending">
      <display>Loading indicator in message bubble</display>
    </state>
  </states>

  <interactions>
    <auto-scroll>Scrolls to bottom on new messages</auto-scroll>
    <form-submit>Enter key or button click sends message</form-submit>
    <message-formatting>whitespace-pre-wrap for message text</message-formatting>
  </interactions>

  <accessibility>
    <aria-labels>Input has placeholder text</aria-labels>
    <keyboard-navigation>Form submission works with Enter key</keyboard-navigation>
  </accessibility>

  <responsive-design>
    <breakpoints>
      <mobile>Default</mobile>
      <tablet>md: (768px+)</tablet>
    </breakpoints>
    <adaptations>
      <adaptation>Message bubbles: max-w-xs on mobile, max-w-md on desktop</adaptation>
      <adaptation>Chat container: fixed height with scroll on all devices</adaptation>
    </adaptations>
  </responsive-design>
</page-structure>

